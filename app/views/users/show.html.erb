<div class='container px-5 px-sm-0'>
  <div class='row'>
    <div class='col-md-3'>
      <h2>User info</h2>
      <%= render 'info', user: @user %>
      <h2 class="mt-3">New book</h2>
      <%= render 'books/form', book: @book %>
    </div>
    <div class='col-md-8 offset-md-1'>
      <h2>Books</h2>
      <%= render 'books/index',books: @books %>

      <% if current_user == @user %>
        <div>
          <h2>投稿数の前日比・前週比</h2>
          <table class='table'>
            <tr>
              <th>今日の投稿数</th>
              <th>前日の投稿数</th>
              <th>前日比</th>
            </tr>
            <tr>
              <td>
                <%= @user.create_books_today %>
              </td>
              <td>
                <%= @user.create_books_yesterday %>
              </td>
              <td>
                <% unless @user.create_books_yesterday == 0 %>
                  <%= @user.create_books_today / @user.create_books_yesterday * 100 %>%
                <% else %>
                  昨日の投稿はありませんでした
                <% end %>
              </td>
            </tr>
          </table>

          <table class='table'>
            <tr>
              <th>今週の投稿数</th>
              <th>前週の投稿数</th>
              <th>前週比</th>
            </tr>
            <tr>
              <td>
                <%= @user.create_books_thisweek %>
              </td>
              <td>
                <%= @user.create_books_lastweek %>
              </td>
              <td>
                <% unless @user.create_books_lastweek == 0 %>
                  <%= @user.create_books_thisweek / @user.create_books_lastweek * 100%>%
                <% else %>
                  先週の投稿はありませんでした
                <% end %>
              </td>
            </tr>
          </table>

          <div>
            <h2>７日間分の投稿数</h2>
            <table>
              <tr>
                <th>6日前</th>
                <th>5日前</th>
                <th>4日前</th>
                <th>3日前</th>
                <th>2日前</th>
                <th>1日前</th>
                <th>今日</th>
              </tr>
              <tr>
                <% @user.number_of_posts_per_week.each do |post_num| %>
                  <td>
                    <%= post_num %>
                  </td>
                <% end %>
              </tr>
            </table>
          </div>
        </div>
      <% end %>
      <%# グラフの記述位置を設定 %>
      <div>
        <canvas id="mychart"></canvas>
      </div>
      <%# Chart.jsをCDNから含める %>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </div>
  </div>
</div>

<script>
  var ctx = document.getElementById('mychart');
  var myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['6日前', '5日前', '4日前', '3日前', '2日前', '1日前', '今日'],
        datasets: [{
            label: '1週間の投稿数',
            data: <%= @user.number_of_posts_per_week %>,
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            y: {
                min: 0,
                max: 10,
                ticks: {
                  stepSize: 1
                }
            }
        }
    }
  });
</script>